

{% block content %}

<div id="flood-exposure-map" style="width: 100%; height: 500px;"></div>

<script src="../../static/javascript/rivers-gensan.min.js"></script>
<script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoiam91bGUyMzMxIiwiYSI6ImNtNzMyczF5YTBmdHIybHB3bXVqMWdiaGgifQ.WW8zxem2Mfu8jPk-L_kSdA';

    
    window.floodExposureMap = new mapboxgl.Map({ 
        container: 'flood-exposure-map',
        center: [121.7740, 12.8797],
        zoom: 4.5,
        style: 'mapbox://styles/mapbox/dark-v10'
    })
    .addControl(new mapboxgl.NavigationControl())
            .addControl(new mapboxgl.GeolocateControl())
            .addControl(new mapboxgl.ScaleControl())
            .addControl(new mapboxgl.FullscreenControl());

            floodExposureMap.on("load", () => {
              floodExposureMap.addSource("rivers", {
                  type: "geojson",
                  data: RiversGensan,
              });
              floodExposureMap.addLayer({
                  id: "rivers",
                  type: "line",
                  source: "rivers",
                  layout: {
                      "line-join": "round",
                      "line-cap": "round",
                  },
                  paint: {
                      "line-color": "#3388ff",
                      "line-width": 4,
                  },
              });
  
              // Add pop-up
              floodExposureMap.on("click", "rivers", (e) => {
                  const properties = e.features[0].properties;
  
                  var description = "";
                  if (properties.name) {
                      description += "<h3>" + properties.name + "</h3>";
                  }
                  description += "<pre>";
                  for (const [key, value] of Object.entries(properties)) {
                      if (["@id", "waterway"].includes(key)) {
                          continue;
                      }
                      description += `${key}: ${value}\n`;
                  }
                  description +=
                      '</pre><p>Data: <a href="https://www.openstreetmap.org/' +
                      properties["@id"] +
                      '" target="_blank">OpenStreetMap</a> / <a href="https://opendatacommons.org/licenses/odbl/1-0/" target="_blank">ODbL</a></p>';
  
                  new mapboxgl.Popup()
                      .setLngLat(e.lngLat)
                      .setHTML(description)
                      .addTo(floodExposureMap);
              });
  
              // Cursor when the mouse is over the layer.
              floodExposureMap.on("mouseenter", "rivers", () => {
                floodExposureMap.getCanvas().style.cursor = "pointer";
              });
              floodExposureMap.on("mouseleave", "rivers", () => {
                floodExposureMap.getCanvas().style.cursor = "";
              });
          });     



    // Create a base yellow circle element
    const floodExposureBaseYellowCircle = document.createElement('div');
    floodExposureBaseYellowCircle.style.width = '20px';
    floodExposureBaseYellowCircle.style.height = '20px';
    floodExposureBaseYellowCircle.style.borderRadius = '50%';
    floodExposureBaseYellowCircle.style.border = '2px solid white';
    floodExposureBaseYellowCircle.style.backgroundColor = '#FFC067';
    {% comment %} const floodExposureMap = new mapboxgl.Map({
        container: 'map', // container ID
        center: [121.7740, 12.8797], // Default center position [lng, lat]
        zoom: 4.5, // Default zoom
        style: 'mapbox://styles/mapbox/streets-v12' // Default map style
    }); {% endcomment %}


    const floodExposureMarker = new mapboxgl.Marker({
      element: floodExposureBaseYellowCircle.cloneNode(true)
        }).setLngLat([120.9849205, 14.59057479]) // Set position dynamically based on row data
        .setPopup(new mapboxgl.Popup().setHTML("<h4>SM Manila Shakeys Branch</h4>" +
  "<a>" +
    "<span style='display:inline-block; width:10px; height:10px; background-color:#FFC067; margin-right:5px;'></span>" +
    "Low Exposure" +
  "</a>")) // add popup
        .addTo(floodExposureMap);

    const floodExposureMarker2 = new mapboxgl.Marker({
      element: floodExposureBaseYellowCircle.cloneNode(true)
        })
        .setLngLat([121.042187, 14.49557534]) // Set position dynamically based on row data
        .setPopup(new mapboxgl.Popup().setHTML("<h4>Commissary in Paranque</h4>" +
  "<a>" +
    "<span style='display:inline-block; width:10px; height:10px; background-color:#FFC067; margin-right:5px;'></span>" +
    "Low Exposure" +
  "</a>")) // add popup
        .addTo(floodExposureMap);

    const floodExposureMarker3 = new mapboxgl.Marker({
      element: floodExposureBaseYellowCircle.cloneNode(true)
    })
    .setLngLat([125.1456158, 6.065404576]) // Set position dynamically based on row data
    .setPopup(new mapboxgl.Popup().setHTML("<h4>Coconut Processing Plant in Gen San</h4>" +
    "<a>" +
      "<span style='display:inline-block; width:10px; height:10px; background-color:#FFC067; margin-right:5px;'></span>" +
      "Low Exposure" +
    "</a>")) // add popup
    .addTo(floodExposureMap);

    const floodExposureMarker4 = new mapboxgl.Marker({
      element: floodExposureBaseYellowCircle.cloneNode(true)
    })
    .setLngLat([125.150691, 6.064051003]) // Set position dynamically based on row data
    .setPopup(new mapboxgl.Popup().setHTML("<h4>Tuna Processing Plant in Gen San</h4>" +
    "<a>" +
      "<span style='display:inline-block; width:10px; height:10px; background-color:#FFC067; margin-right:5px;'></span>" +
      "Low Exposure" +
    "</a>")) // add popup
    .addTo(floodExposureMap);
        
</script>

{% endblock %}