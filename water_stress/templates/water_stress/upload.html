{% extends "base.html" %}

{% block title %}
    Upload Facility CSV
{% endblock %}

{% block content %}

    <div class="container mt-4">
      <div class="row">
        <div class="col-6 d-flex flex-column">
          <!-- Rounded Icon Container with Margin -->
          <div style="
              width: 60px; /* Container size */
              height: 60px; 
              display: flex;
              align-items: center;
              justify-content: center;
              border-radius: 20px; /* Rounded corners */
              background-color: black; /* Black background */
              margin-top: 10px; /* Adds space above the icon */
              margin-bottom: 10px; /* Adds space below the icon */
          ">
            <i class="fa-solid fa-gauge-high" style="
                font-size: 30px; /* Larger icon */
                color: white; /* White icon color */
            "></i>
          </div>
      
          <!-- Heading below the icon with Margin -->
          <h1 style="
              margin-bottom: 20px; /* Space below the text */
          ">Water Stress Analysis</h1>
        </div>
      </div>
      

        <div class="row">
            <div class="col-md-12">
                <form action="{% url 'water_stress:upload_water_stress_facility_csv' %}" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row d-flex align-items-stretch">
                      <!-- First Card: Dynamic Fields -->
                      <div class="col-md-6">
                        <div class="card h-100 mb-3 custom-card" style="
                        background-color: #FFFFFF; 
                        border: none !important; 
                        box-shadow: none !important;">
                          <div class="card-header no-border" style="background-color: #FFFFFF; border-bottom: none;">
                            <strong>Select Data Fields</strong>
                          </div>
                          <div class="card-body">
                            <div class="form-group">
                              <label class="control-label" style="margin-bottom: 20px; /* Space below the text */">Select Fields to include in analysis.</label>
                              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                                {% for field in available_fields %}
                                <div class="form-check checkbox-container" style="
                                display: flex; 
                                align-items: center; 
                                background-color: #F8F9FA; 
                                border-radius: 8px; 
                                padding: 16px; 
                                gap: 8px; 
                                width: 100%; 
                                min-width: 185px; 
                                border: 2px solid transparent;
                                transition: all 0.3s ease-in-out;
                                cursor: pointer;
                            ">
                                <!-- Custom Checkbox -->
                                <input type="checkbox" class="form-check-input" name="fields" value="{{ field }}" id="{{ field }}" style="
                                    margin-left: 10px; 
                                    width: 20px; 
                                    height: 20px;
                                    cursor: pointer;
                                    appearance: none; /* Hide default checkbox */
                                    background-color: #F7F7F7; /* Initial gray background */
                                    border: 2px solid #000; /* Black border */
                                    border-radius: 4px; /* Rounded edges */
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    position: relative;
                                    transition: all 0.3s ease-in-out;
                                " onclick="toggleCheckbox(this)">
                            
                                
                            
                                <label class="form-check-label" for="{{ field }}" style="
                                    font-size: 16px; 
                                    font-weight: 500; 
                                    color: #333;
                                    cursor: pointer;
                                    margin-left: 10px;
                                ">
                                    {{ field }}
                                </label>
                            </div>
                                {% endfor %}
                              </div>
                              
                            </div>
                          </div>
                        </div>
                      </div>
                  
                      <!-- Second Card: File Upload -->
                      <div class="col-md-6">
                        <div class="card h-100 mb-3 custom-card" style="
                        background-color: #FFFFFF; 
                        border: none !important; 
                        box-shadow: none !important;">
                          <div class="card-header no-border" style="background-color: #FFFFFF; border-bottom: none; margin: 10px 0 0 20px">
                            <strong>Upload Files</strong>
                          </div>
                          <div class="card-body" style="display: flex; flex-direction: column;  width: 100%; margin: -10px 0 0 20px">

                            <!-- Label Container -->
                            <div style="
                                width: 100%; 
                                max-width: 400px; 
                          
                                margin-bottom: 40px;
                            ">
                                <label class="control-label">
                                    Please upload the facility location CSV.
                                </label>
                            </div>

                            <div style="
                                display: flex; 
                                justify-content: center; 
                                align-items: center; 
                                margin-top: 10px
                                width: 100%;
                            ">
                            <!-- File Input Container -->
                            <div style="
                                width: 100%;
                                {% comment %} max-width: 350px;  {% endcomment %}
                                height: 150px;
                                border: 2px dashed #ccc; /* Dashed border */
                                border-radius: 10px;
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                                justify-content: center;
                                cursor: pointer;
                                background-color: #f8f8f8;
                                transition: background-color 0.3s ease-in-out;
                                margin-right: 40px;
                              
                            "
                                onclick="document.getElementById('facilityCsv').click()">
                        
                                <!-- Upload Icon -->
                                <i class="fas fa-upload" style="
                                    font-size: 24px; 
                                    color: #777; 
                                    margin-bottom: 8px;
                                "></i>
                        
                                <!-- Choose File Text -->
                                <label for="facilityCsv" style="
                                    font-size: 14px; 
                                    font-weight: bold; 
                                    color: #333;
                                    cursor: pointer;
                                ">
                                    Choose File
                                </label>
                        
                                <!-- File Name Display -->
                                <p id="file-name" style="
                                    font-size: 12px; 
                                    color: #777; 
                                    margin-top: 4px;
                                ">No file chosen</p>
                            </div>
                          </div>
                        </div>
                        
                        <!-- Hidden File Input -->
                        <input type="file" name="facility_csv" id="facilityCsv" accept=".csv" 
                            style="display: none;" onchange="updateFileName()">
                          <div class="card-footer text-center" style="background-color: #FFFFFF; border-top: none;">
                            <div style="
                                width: 100%; /* Ensures full width */
                                padding-left: 20px; 
                                padding-right: 20px;
                            ">
                                <button type="submit" class="btn btn-warning" style="
                                    width: 100%; /* Button takes full width inside the div */
                                    padding: 12px; /* Increases padding for better touch area */
                                    font-size: 16px; /* Slightly larger text */
                                    margin-top: -10px;
                                ">
                                    <strong>Generate table & plot</strong>
                                </button>
                            </div>
                          </div>
                        </div>
                      </div>
                      
                    </div>
                  </form>
            </div>
        </div>

        {% if error %}
            <div class="alert alert-danger mt-3">{{ error }}</div>
        {% endif %}
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      function toggleCheckbox(checkbox) {
          let container = checkbox.closest('.checkbox-container');

          if (checkbox.checked) {
              container.style.backgroundColor = '#FFF8C7'; // Change background to light yellow
              container.style.border = '2px solid #F1D500'; // Add yellow border
              checkbox.style.backgroundColor = '#000'; // Change checkbox to black
              checkbox.style.borderColor = '#000'; // Keep border black
          } else {
              container.style.backgroundColor = '#F8F9FA'; // Revert background to gray
              container.style.border = '2px solid transparent'; // Remove border
              checkbox.style.backgroundColor = '#F7F7F7'; // Reset checkbox background to gray
              checkbox.style.borderColor = '#000'; // Keep border black
          }
      }

    function updateFileName() {
        var input = document.getElementById("facilityCsv");
        var fileNameDisplay = document.getElementById("file-name");

        if (input.files.length > 0) {
            fileNameDisplay.textContent = input.files[0].name;
        } else {
            fileNameDisplay.textContent = "No file chosen";
        }
    }
  </script>
  
    
{% endblock %}



